<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Valentine‚Äôs Letter üíñ</title>

<style>
* {
  box-sizing: border-box;
  -webkit-tap-highlight-color: transparent;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
}

body {
  margin: 0;
  width: 100vw;
  height: 100vh;
  overflow: hidden;
  background: #fde6ec;
  display: flex;
  align-items: center;
  justify-content: center;
}

/* ================= STAGE ================= */

#stage {
  position: relative;
  width: 90vw;
  max-width: 380px;
}

/* ================= LETTER ================= */

#letter-container {
  width: 100%;
  perspective: 1200px;
}

.card {
  position: relative;
  width: 100%;
  transform-style: preserve-3d;
  transition: transform 1s;
}

.card.flipped {
  transform: rotateY(180deg);
}

.side {
  position: absolute;
  width: 100%;
  top: 0;
  left: 0;
  backface-visibility: hidden;
}

.back {
  transform: rotateY(180deg);
}

/* ================= ENVELOPE ================= */

#envelope {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  z-index: 5;
  cursor: pointer;
}

#envelope img {
  width: 100%;
  display: block;
}

#env-front {
  position: absolute;
  top: 0;
  left: 0;
}

.drop {
  animation: dropDown 1.2s ease-in forwards;
}

@keyframes dropDown {
  to {
    transform: translateY(120vh);
    opacity: 0;
  }
}

/* ================= BUTTONS ================= */

.btn {
  margin-top: 14px;
  padding: 14px 24px;
  border-radius: 30px;
  font-size: 16px;
  border: none;
  cursor: pointer;
  background: #ff6f91;
  color: white;
  box-shadow: 0 8px 18px rgba(0,0,0,0.15);
}

.btn.alt {
  background: #ff4f81;
}

.btn.no {
  background: #888;
  position: absolute;
}

#turn-btn {
  display: flex;
  justify-content: center;
  margin-top: 12px;
}

#proposal-buttons {
  position: relative;
  margin-top: 16px;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 12px;
}
</style>
</head>

<body>

<div id="stage">

  <!-- LETTER (ALWAYS FIXED IN PLACE) -->
  <div id="letter-container">
    <div class="card" id="card">

      <div class="side front">
        <img src="letter-1.png" style="width:100%">
        <div id="turn-btn">
          <button class="btn">üíå Click to turn over</button>
        </div>
      </div>

      <div class="side back">
        <img src="letter-2.png" style="width:100%">
        <div id="proposal-buttons">
          <button class="btn" onclick="addToCalendar()">Yes ü•∫</button>
          <button class="btn alt" onclick="addToCalendar()">Absolutely Yes üíñ</button>
          <button class="btn no" id="noBtn">No üòè</button>
        </div>
      </div>

    </div>
  </div>

  <!-- ENVELOPE (ON TOP OF LETTER) -->
  <div id="envelope">
    <img src="envelope-back.png">
    <img src="envelope-front.png" id="env-front">
  </div>

</div>

<script>
const envelope = document.getElementById('envelope');
const card = document.getElementById('card');
const noBtn = document.getElementById('noBtn');

/* OPEN ENVELOPE */
envelope.addEventListener('click', () => {
  envelope.classList.add('drop');
}, { once: true });

/* FLIP LETTER */
document.querySelector('#turn-btn button').addEventListener('click', (e) => {
  e.stopPropagation();
  card.classList.add('flipped');
});

/* NO BUTTON DODGE */
noBtn.addEventListener('touchstart', moveNo);
noBtn.addEventListener('mouseover', moveNo);

function moveNo() {
  const maxX = window.innerWidth - noBtn.offsetWidth - 20;
  const maxY = window.innerHeight - noBtn.offsetHeight - 20;
  noBtn.style.left = Math.random() * maxX + 'px';
  noBtn.style.top = Math.random() * maxY + 'px';
}

/* CALENDAR INVITE (iPhone) */
function addToCalendar() {
  const ics = `BEGIN:VCALENDAR
VERSION:2.0
BEGIN:VEVENT
SUMMARY:Valentine‚Äôs Date üíñ
DTSTART;VALUE=DATE:20260214
DTEND;VALUE=DATE:20260215
END:VEVENT
END:VCALENDAR`;

  const blob = new Blob([ics], { type: 'text/calendar' });
  const link = document.createElement('a');
  link.href = URL.createObjectURL(blob);
  link.download = 'valentines-date.ics';
  document.body.appendChild(link);
  link.click();
  document.body.removeChild(link);
}
</script>

</body>
</html>
